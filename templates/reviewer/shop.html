<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>상점 | 보상 교환 상점</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f7f8fb; --card:#fff; --text:#111827; --muted:#6b7280;
      --primary:#6d28d9; --primary-600:#7c3aed; --border:#e5e7eb;
      --chip:#f3f4f6; --shadow:0 6px 24px rgba(0,0,0,.06);
      --danger:#ef4444; --success:#10b981;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Noto Sans KR",Apple SD Gothic Neo,Malgun Gothic,sans-serif}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:16px 20px 32px}

    /* Header */
    .shop-header{
      position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:saturate(180%) blur(8px);
      border-bottom:1px solid var(--border);z-index:50
    }
    .shop-header .inner{display:flex;gap:16px;align-items:center;justify-content:space-between;max-width:1100px;margin:0 auto;padding:12px 20px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    /* (요청) 임시 보라색 아이콘 제거 -> .logo 삭제 */

    .search{flex:1;display:flex;gap:8px;max-width:520px;margin:0 12px}
    .search input{flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}
    .badge-balance{white-space:nowrap;border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:12px;font-weight:800}

    /* Tabs (요청) 브랜드 글자와 같은 좌측 정렬선에 맞추기 위해 .inner 래핑 */
    .tabs-wrap{max-width:1100px;margin:0 auto;padding:0 20px 12px}
    .tabs{display:flex;gap:8px;overflow:auto;padding-top:8px;border-top:1px solid var(--border)}
    .tab{flex:0 0 auto;padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:#fff;font-weight:800;color:#374151}
    .tab.active{border-color:#c4b5fd;background:#f5f3ff;color:#4c1d95}

    /* Subchips */
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0 6px}
    .chip{padding:8px 12px;border-radius:999px;background:var(--chip);color:#374151;border:1px solid var(--border);cursor:pointer}
    .chip.active{background:#eef2ff;border-color:#c7d2fe;color:#1e3a8a}

    /* Toolbar */
    .toolbar{display:flex;align-items:center;gap:10px;justify-content:space-between;margin:8px 0 16px}
    .toolbar .left{color:var(--muted)}
    .toolbar .right{display:flex;gap:10px;align-items:center}
    select,.toggle{padding:9px 12px;border:1px solid var(--border);background:#fff;border-radius:10px}
    .toggle{display:flex;gap:8px;align-items:center;font-weight:700}

    /* Grid */
    .grid{display:grid;gap:16px;grid-template-columns:repeat(4,1fr)}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}

    /* Card */
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .thumb{aspect-ratio:1/1;background:#fafafa;position:relative}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .badge{position:absolute;left:10px;top:10px;background:#111827;color:#fff;font-size:12px;padding:4px 8px;border-radius:999px;opacity:.9}
    .content{padding:14px 14px 12px;display:flex;flex-direction:column;gap:6px}
    .title{font-weight:800;line-height:1.35}
    .desc{font-size:13px;color:var(--muted);height:2.6em;overflow:hidden}
    .price{display:flex;gap:8px;align-items:baseline;margin-top:4px}
    .coin{font-weight:900}
    .cash{font-size:13px;color:var(--muted);text-decoration:none}
    .actions{margin-top:auto;display:flex;gap:8px}
    .btn{flex:1;text-align:center;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;font-weight:800;cursor:pointer}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.primary:hover{background:var(--primary-600)}
    .soldout{opacity:.6;pointer-events:none;position:relative}
    .soldout::after{content:"품절";position:absolute;top:10px;right:10px;background:var(--danger);color:#fff;font-size:12px;padding:4px 8px;border-radius:999px}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="shop-header">
    <div class="inner">
      <div class="brand">
        <!-- (요청) 왼쪽 보라색 아이콘 삭제. 나중에 <img src="..." alt="로고"> 넣으세요 -->
        <div>보상 교환 상점</div>
      </div>
      <div class="search">
        <input id="q" type="search" placeholder="검색: 스타벅스, 커피, 치킨..." />
      </div>
      <div class="badge-balance">보유 ⭐ <span id="balance">{{ coins|int }}</span></div>
    </div>

    <!-- MAIN CATEGORY TABS: 브랜드 텍스트 좌측 정렬과 맞춤 -->
    <div class="tabs-wrap">
      <nav class="tabs" id="tabs">
        <button class="tab active" data-cat="giftcard">교환권</button>
        <button class="tab" data-cat="avatar">패션</button>
        <button class="tab" data-cat="digital">디지털</button>
        <button class="tab" data-cat="food">식품</button>
        <button class="tab" data-cat="beauty">뷰티</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- SUBCATEGORY CHIPS -->
    <div class="chips" id="chips"></div>

    <!-- TOOLBAR -->
    <div class="toolbar">
      <div class="left"><span id="count">0</span>개의 아이템</div>
      <div class="right">
        <label class="toggle"><input id="onlyCoin" type="checkbox" /> ⭐ 결제만 보기</label>
        <select id="sort">
          <option value="popular">인기순</option>
          <option value="latest">최신순</option>
          <option value="priceAsc">가격(별) 낮은순</option>
          <option value="priceDesc">가격(별) 높은순</option>
        </select>
      </div>
    </div>

    <!-- PRODUCT GRID -->
    <section class="grid" id="grid"></section>
  </main>

  <script>
  const categories = [
    { key:'giftcard', label:'기프티콘', subs:['카페','치킨','버거/피자','편의점','한식/중식/일식'] },
    { key:'avatar',   label:'아바타', subs:['헤어','의상','액세서리'] },
    { key:'digital',  label:'디지털', subs:['OTT','음원','클라우드'] },
    { key:'food',     label:'식품', subs:['간편식','간식','건강식품'] },
    { key:'beauty',   label:'뷰티', subs:['스킨케어','바디케어','향수'] },
  ];

  // Flask에서 넘겨받은 CSV 기반 데이터
  const csvProducts = {{ products | tojson | safe }};

  // 추가 예시 데이터
  const extraProducts = [
    { id:101, name:'스타벅스 아메리카노', short:'모바일 교환권', badge:'기프티콘',
      category:'giftcard', subcategory:'카페', star_price:4000, cash_price:4700,
      image_url:'https://images.unsplash.com/photo-1517705008128-361805f42e86?q=80&w=800&auto=format&fit=crop'
    },
    { id:102, name:'이디야 카페라떼 세트', short:'모바일 교환권', badge:'기프티콘',
      category:'giftcard', subcategory:'카페', star_price:19000, cash_price:2000,
      image_url:'https://images.unsplash.com/photo-1498804103079-a6351b050096?q=80&w=800&auto=format&fit=crop'
    },
    { id:103, name:'BHC 치킨', short:'뿌링클', badge:'기프티콘',
      category:'giftcard', subcategory:'치킨', star_price:20000, cash_price:22500,
      image_url:'https://images.unsplash.com/photo-1604908177079-1163cfe2fdb8?q=80&w=800&auto=format&fit=crop'
    },
    { id:104, name:'편의점 1만원권', short:'전국 CU 사용', badge:'기프티콘',
      category:'giftcard', subcategory:'편의점', star_price:8000, cash_price:10000,
      image_url:'https://images.unsplash.com/photo-1556740749-887f6717d7e4?q=80&w=800&auto=format&fit=crop'
    },
    { id:105, name:'캐주얼 헤어 A', short:'3D 아바타용 헤어', badge:'아바타',
      category:'avatar', subcategory:'헤어', star_price:200, cash_price:6900,
      image_url:'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=800&auto=format&fit=crop'
    },
    { id:106, name:'스트리트 재킷', short:'아바타 의상', badge:'아바타',
      category:'avatar', subcategory:'의상', star_price:65000, cash_price:99000,
      image_url:'https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=800&auto=format&fit=crop'
    },
    { id:107, name:'넷플릭스 1개월', short:'디지털 코드', badge:'디지털',
      category:'digital', subcategory:'OTT', star_price:10000, cash_price:13500,
      image_url:'https://images.unsplash.com/photo-1581905764498-f1b60bae941a?q=80&w=800&auto=format&fit=crop'
    },
    { id:108, name:'한식 세트', short:'즉석 간편식', badge:'식품',
      category:'food', subcategory:'간편식', star_price:22000, cash_price:26900,
      image_url:'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=800&auto=format&fit=crop'
    }
  ];

  // CSV 데이터 + 추가 예시 데이터 통합
  const products = [...csvProducts, ...extraProducts];

  let state = { cat: categories[0].key, sub:null, query:'', onlyCoin:false, sort:'popular' };
  const tabs  = document.getElementById('tabs');
  const chips = document.getElementById('chips');
  const grid  = document.getElementById('grid');
  const count = document.getElementById('count');
  const q     = document.getElementById('q');
  const onlyCoin = document.getElementById('onlyCoin');
  const sortSel  = document.getElementById('sort');

  tabs.addEventListener('click', e=>{
    const btn = e.target.closest('.tab'); if(!btn) return;
    [...tabs.children].forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    state.cat = btn.dataset.cat; state.sub = null; renderChips(); renderGrid();
  });

  q.addEventListener('input', ()=>{ state.query = q.value.trim(); renderGrid(); });
  onlyCoin.addEventListener('change', ()=>{ state.onlyCoin = onlyCoin.checked; renderGrid(); });
  sortSel.addEventListener('change', ()=>{ state.sort = sortSel.value; renderGrid(); });

  function renderChips(){
    const cat = categories.find(c=>c.key===state.cat);
    chips.innerHTML = '';
    (cat?.subs||[]).forEach(s=>{
      const el = document.createElement('button');
      el.className = 'chip'+(state.sub===s?' active':'');
      el.textContent = s;
      el.onclick = ()=>{ state.sub = (state.sub===s ? null : s); renderChips(); renderGrid(); };
      chips.appendChild(el);
    });
  }

  function renderGrid(){
    let list = products.filter(p=>p.category===state.cat);
    if(state.sub) list = list.filter(p=>p.subcategory===state.sub);
    if(state.query){
      const k = state.query.toLowerCase();
      list = list.filter(p=>(p.name+p.short).toLowerCase().includes(k));
    }
    if(state.onlyCoin) list = list.filter(p=>p.star_price && p.star_price>0);

    switch(state.sort){
      case 'priceAsc':  list.sort((a,b)=> (a.star_price||999999) - (b.star_price||999999)); break;
      case 'priceDesc': list.sort((a,b)=> (b.star_price||0) - (a.star_price||0)); break;
      case 'latest':    list = list.slice().reverse(); break;
    }

    count.textContent = list.length;
    grid.innerHTML = list.map(p=>`
      <article class="card" data-id="${p.id}">
        <div class="thumb">
          <img src="${p.image_url}" alt="${p.name}" loading="lazy"/>
          <span class="badge">${p.badge||''}</span>
        </div>
        <div class="content">
          <div class="title">${p.name}</div>
          <div class="desc">${p.short||''}</div>
          <div class="price">
            <span class="coin">⭐ ${p.star_price?.toLocaleString?.() ?? '-'}</span>
            <span class="cash">₩${(p.cash_price||0).toLocaleString()}</span>
          </div>
          <div class="actions">
            <a class="btn" href="#">담기</a>
            <a class="btn primary" href="/shop/purchase/${p.id}">교환하기</a>
          </div>
        </div>
      </article>
    `).join('');
  }

  renderChips();
  renderGrid();
</script>


</body>
</html>
